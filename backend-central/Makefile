.PHONY: all setup run clean

# Default: chá»‰ cáº§n gÃµ "make"
all: check-and-run

# Check deps â†’ setup náº¿u thiáº¿u â†’ run
check-and-run:
	@if [ ! -d "venv" ]; then \
		echo "âš ï¸  venv not found, running setup..."; \
		$(MAKE) setup; \
	fi
	@$(MAKE) run

# Setup: táº¡o venv + cÃ i python packages
setup:
	@echo "ðŸ“¦ Creating venv..."
	@rm -rf venv
	@python3 -m venv venv
	@echo "ðŸ“¥ Installing Python packages..."
	@bash -c "source venv/bin/activate && pip install -q --upgrade pip && pip install -q -r requirements.txt"
	@mkdir -p data
	@echo "âœ… Setup complete"

# Run app
run:
	@if [ ! -d "venv" ]; then \
		echo "âŒ venv not found. Run 'make setup' first."; \
		exit 1; \
	fi
	@echo "ðŸŽ¯ Starting Central Server..."
	@bash -c "source venv/bin/activate && python3 app.py"

# Clean cache
clean:
	@find . -type d -name "__pycache__" -exec rm -rf {} + 2>/dev/null || true
	@find . -type f -name "*.pyc" -delete 2>/dev/null || true
	@echo "âœ… Clean complete"
